<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Película - Pelicula Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen font-sans">

    <nav class="p-6 bg-zinc-900 border-b border-zinc-800 flex justify-between items-center shadow-xl">
        <button onclick="location.href='monitoreo-peliculas.html'" class="text-zinc-400 hover:text-white transition">← Cancelar y Volver</button>
        <h1 class="text-xl font-black text-red-600 tracking-tighter">MODIFICAR CONTENIDO EN CLOUD</h1>
        <div class="w-20"></div>
    </nav>

    <div class="max-w-2xl mx-auto mt-12 p-8 bg-zinc-900 rounded-2xl border border-zinc-800 shadow-2xl">
        <form id="formEditar" class="space-y-5">
            <input type="hidden" id="peliculaId">
            
            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-2 tracking-widest">Título de la Obra</label>
                <input type="text" id="titulo" required class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none transition">
            </div>

            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs font-bold text-zinc-500 uppercase mb-2 tracking-widest">Género</label>
                    <input type="text" id="genero" required class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none transition">
                </div>
                <div>
                    <label class="block text-xs font-bold text-zinc-500 uppercase mb-2 tracking-widest">Año de Lanzamiento</label>
                    <input type="number" id="anio" required class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none transition">
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-2 tracking-widest">URL del Póster (Imagen)</label>
                <input type="url" id="urlImagen" required class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none transition">
            </div>

            <div>
                <label class="block text-xs font-bold text-red-500 uppercase mb-2 tracking-widest">ID del Tráiler (YouTube)</label>
                <input type="text" id="urlTrailer" placeholder="Ej: dQw4w9WgXcQ" 
                       class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none transition">
                <p class="text-[10px] text-zinc-500 mt-1 italic">Solo el código después del 'v=' en la URL de YouTube.</p>
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-2 tracking-widest">Sinopsis Detallada</label>
                <textarea id="sinopsis" rows="4" required class="w-full p-3 bg-zinc-800 rounded-lg border border-zinc-700 focus:border-red-600 outline-none resize-none transition"></textarea>
            </div>

            <button type="submit" class="w-full bg-blue-600 py-4 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-900/30 transform active:scale-95">
                SINCRONIZAR CAMBIOS CON AWS RDS
            </button>
        </form>
    </div>

    <script>
        const API_URL = "http://pelicula-api.us-east-2.elasticbeanstalk.com/api/peliculas";
        const idParaEditar = localStorage.getItem('idPeliculaEditar');

        // 1. Cargar datos actuales desde AWS
        async function cargarDatos() {
            if (!idParaEditar) {
                alert("No se detectó ID de película. Volviendo al monitoreo.");
                location.href = 'monitoreo-peliculas.html';
                return;
            }

            try {
                const res = await fetch(`${API_URL}/${idParaEditar}`);
                const p = await res.json();

                document.getElementById('peliculaId').value = p.id;
                document.getElementById('titulo').value = p.titulo;
                document.getElementById('genero').value = p.genero;
                document.getElementById('anio').value = p.anioLanzamiento;
                document.getElementById('urlImagen').value = p.urlImagen;
                document.getElementById('urlTrailer').value = p.urlTrailer || ""; // Carga el trailer si existe
                document.getElementById('sinopsis').value = p.sinopsis;
            } catch (error) {
                console.error("Error al cargar datos:", error);
                alert("Error al obtener datos desde la nube.");
            }
        }

        // 2. Enviar actualización vía PUT
        document.getElementById('formEditar').addEventListener('submit', async (e) => {
            e.preventDefault();

            const peliculaActualizada = {
                id: parseInt(document.getElementById('peliculaId').value),
                titulo: document.getElementById('titulo').value,
                genero: document.getElementById('genero').value,
                anioLanzamiento: parseInt(document.getElementById('anio').value),
                urlImagen: document.getElementById('urlImagen').value,
                urlTrailer: document.getElementById('urlTrailer').value, // Envia el nuevo campo
                sinopsis: document.getElementById('sinopsis').value
            };

            try {
                const response = await fetch(`${API_URL}/${idParaEditar}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(peliculaActualizada)
                });

                if (response.ok) {
                    alert("✅ Cambios guardados en AWS exitosamente.");
                    location.href = 'monitoreo-peliculas.html';
                } else {
                    const errorMsg = await response.text();
                    alert("❌ Error al actualizar: " + errorMsg);
                }
            } catch (error) {
                console.error("Error en el PUT:", error);
                alert("❌ Error de conexión con Elastic Beanstalk.");
            }
        });

        window.onload = cargarDatos;
    </script>
</body>
</html>